{% extends 'base.html' %}

{% block title %}Meal Plan{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

    <div class="row mb-4">
        <div class="col-md-6">
            <h2><i class="bi bi-calendar3"></i> Weekly Meal Plan</h2>
            <p class="text-muted">
                Week of {{ start_date|date:"F j, Y" }}
            </p>
        </div>
        <div class="col-md-6 text-end">

            <div class="btn-group me-2" role="group">
                <a href="?week_start={{ prev_week|date:'Y-m-d' }}" class="btn btn-outline-primary">
                    <i class="bi bi-chevron-left"></i> Previous
                </a>
                <a href="?week_start={{ today|date:'Y-m-d' }}" class="btn btn-outline-primary">
                    <i class="bi bi-calendar-today"></i> Today
                </a>
                <a href="?week_start={{ next_week|date:'Y-m-d' }}" class="btn btn-outline-primary">
                    Next <i class="bi bi-chevron-right"></i>
                </a>
            </div>


            <div class="btn-group" role="group">
                <a href="{% url 'generate_meal_plan' %}" class="btn btn-success">
                    Generate Plan
                </a>
            </div>
        </div>
    </div>


    {% for day in weekly_plan %}
    <div class="card shadow-sm mb-3">
        <div class="card-header" style="background-color: {% cycle '#e3f2fd' '#f3e5f5' '#fff3e0' '#e8f5e9' '#fce4ec' '#e0f2f1' '#f1f8e9' %};">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-0">

                        {{ day.date|date:"l, F j, Y" }}
                        {% if day.date == today %}
                        <span class="badge bg-primary ms-2">Today</span>
                        {% endif %}
                    </h5>
                </div>
                <div class="col-md-6 text-end">
                    {% if day.meals %}



                    <a href="{% url 'regenerate_day' date_str=day.date|date:'Y-m-d' %}"
                       class="btn btn-sm btn-warning"
                       onclick="return confirm('Regenerate all meals for this day?')">
                        <i class="bi bi-arrow-clockwise"></i> Regenerate Day
                    </a>
                    <a href="{% url 'execute_daily_plan' date_str=day.date|date:'Y-m-d' %}"
                       class="btn btn-sm btn-success"
                       onclick="return confirm('Copy this day\'s plan to your food log?')">
                        <i class="bi bi-check-circle"></i> Execute Plan
                    </a>
                    {% else %}
                    <span class="text-muted">No meals planned</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="card-body">
            <div class="row g-3">

                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Breakfast
                        </h6>
                        {% if day.meals_by_type.breakfast %}
                            {% for meal in day.meals_by_type.breakfast %}
                            <div class="card meal-card border-warning mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">
                                        {{ meal.custom_title|truncatewords:5 }}
                                    </h6>
                                    <p class="card-text small text-muted mb-2">
                                        <i class=""></i> {{ meal.custom_calories|floatformat:0 }} kcal
                                        <br>
                                        P: {{ meal.custom_protein|floatformat:0 }}g |
                                        C: {{ meal.custom_carbohydrates|floatformat:0 }}g |
                                        F: {{ meal.custom_fat|floatformat:0 }}g
                                    </p>

                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Lunch
                        </h6>
                        {% if day.meals_by_type.lunch %}
                            {% for meal in day.meals_by_type.lunch %}
                            <div class="card meal-card border-success mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">
                                        {{ meal.custom_title|truncatewords:5 }}
                                    </h6>
                                    <p class="card-text small text-muted mb-2">
                                        <i class=""></i> {{ meal.custom_calories|floatformat:0 }} kcal
                                        <br>
                                        P: {{ meal.custom_protein|floatformat:0 }}g |
                                        C: {{ meal.custom_carbohydrates|floatformat:0 }}g |
                                        F: {{ meal.custom_fat|floatformat:0 }}g
                                    </p>

                                </div>
                            </div>
                            {% endfor %}
                        
                        {% endif %}
                    </div>
                </div>


                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Dinner
                        </h6>
                        {% if day.meals_by_type.dinner %}
                            {% for meal in day.meals_by_type.dinner %}
                            <div class="card meal-card border-primary mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">
                                        {{ meal.custom_title|truncatewords:5 }}
                                    </h6>
                                    <p class="card-text small text-muted mb-2">
                                        <i class=""></i> {{ meal.custom_calories|floatformat:0 }} kcal
                                        <br>
                                        P: {{ meal.custom_protein|floatformat:0 }}g |
                                        C: {{ meal.custom_carbohydrates|floatformat:0 }}g |
                                        F: {{ meal.custom_fat|floatformat:0 }}g
                                    </p>

                                </div>
                            </div>
                            {% endfor %}

                        {% endif %}
                    </div>
                </div>


                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Supper
                        </h6>
                        {% if day.meals_by_type.supper %}
                            {% for meal in day.meals_by_type.supper %}
                            <div class="card meal-card border-info mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">
                                        {{ meal.custom_title|truncatewords:5 }}
                                    </h6>
                                    <p class="card-text small text-muted mb-2">
                                        <i class=""></i> {{ meal.custom_calories|floatformat:0 }} kcal
                                        <br>
                                        P: {{ meal.custom_protein|floatformat:0 }}g |
                                        C: {{ meal.custom_carbohydrates|floatformat:0 }}g |
                                        F: {{ meal.custom_fat|floatformat:0 }}g
                                    </p>

                                </div>
                            </div>
                            {% endfor %}

                        {% endif %}
                    </div>
                </div>


                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Snack
                        </h6>
                        {% if day.meals_by_type.snack %}
                            {% for meal in day.meals_by_type.snack %}
                            <div class="card meal-card border-secondary mb-2">
                                <div class="card-body p-2">
                                    <h6 class="card-title mb-1" style="font-size: 0.9rem;">
                                        {{ meal.custom_title|truncatewords:5 }}
                                    </h6>
                                    <p class="card-text small text-muted mb-2">
                                        <i class=""></i> {{ meal.custom_calories|floatformat:0 }} kcal
                                        <br>
                                        P: {{ meal.custom_protein|floatformat:0 }}g |
                                        C: {{ meal.custom_carbohydrates|floatformat:0 }}g |
                                        F: {{ meal.custom_fat|floatformat:0 }}g
                                    </p>
                                    <!---W kazdym powinno byc to samo co tu wycialem i jest w notatniku--->
                                </div>
                            </div>
                            {% endfor %}

                        {% endif %}
                    </div>
                </div>


                <div class="col-md-2">
                    <div class="meal-column">
                        <h6 class="text-center mb-3">
                            <i class=""></i> Summary
                        </h6>
                        {% if day.meals %}
                        <div class="card border-dark">
                            <div class="card-body p-2">
                                <h6 class="card-title mb-2">Daily Total</h6>
                                <ul class="list-unstyled small mb-0">
                                    <li><i class="text-danger"></i> <strong>{{ day.total_macros.calories|floatformat:0 }}</strong> kcal</li>
                                    <li><i class="text-warning"></i> <strong>{{ day.total_macros.protein|floatformat:0 }}g</strong> protein</li>
                                    <li><i class="text-info"></i> <strong>{{ day.total_macros.carbohydrates|floatformat:0 }}g</strong> carbs</li>
                                    <li><i class="text-primary"></i> <strong>{{ day.total_macros.fat|floatformat:0 }}g</strong> fat</li>
                                </ul>
                            </div>
                        </div>
                        {% else %}
                        <div class="card border-secondary">
                            <div class="card-body p-3 text-center">
                                <p class="text-muted mb-0 small">No meals planned for this day</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

   <div class="text-center my-4">
    <a href="{% url 'generate_meal_plan' %}?start_date={{ start_date|date:'Y-m-d' }}"
       class="btn btn-success btn-lg"
       onclick="return confirm('Generate meals for this week? Existing meals will be replaced.')">

        {% if weekly_plan.0.meals %}Regenerate{% else %}Generate{% endif %} Week
    </a>
</div>
</div>

<style>


.meal-column {
    min-height: 150px;
}
</style>
{% endblock %}
